<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>My Project: src/runtime/dedos_threads.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_bf9f26469d00835ba20ff8d80ee5a804.html">runtime</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">dedos_threads.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="dedos__threads_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;</div>
<div class="line"><a name="l00008"></a><span class="lineno"><a class="line" href="dedos__threads_8c.html#a369266c24eacffb87046522897a570d5">    8</a></span>&#160;<span class="preprocessor">#define _GNU_SOURCE</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="dedos__threads_8h.html">dedos_threads.h</a>&quot;</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="thread__message_8h.html">thread_message.h</a>&quot;</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="output__thread_8h.html">output_thread.h</a>&quot;</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="logging_8h.html">logging.h</a>&quot;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="rt__stats_8h.html">rt_stats.h</a>&quot;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &lt;stdbool.h&gt;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &lt;sched.h&gt;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &lt;sys/resource.h&gt;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div>
<div class="line"><a name="l00022"></a><span class="lineno"><a class="line" href="dedos__threads_8c.html#a705cb27a1ac6915760cf88cebba062ca">   22</a></span>&#160;<span class="preprocessor">#define MAX_DEDOS_THREAD_ID 32</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00024"></a><span class="lineno"><a class="line" href="dedos__threads_8c.html#a009855593b59738d24dbfc236edb3b14">   24</a></span>&#160;<span class="preprocessor">#define MAX_CORES 16</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00027"></a><span class="lineno"><a class="line" href="dedos__threads_8c.html#a56ecb7e9b922bd8793d20eaebf793be7">   27</a></span>&#160;<span class="preprocessor">#define OUTPUT_THREAD_INDEX MAX_DEDOS_THREAD_ID + 1</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00030"></a><span class="lineno"><a class="line" href="dedos__threads_8c.html#a3c60433df66ec61cd178275f4231db3d">   30</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structdedos__thread.html">dedos_thread</a> *<a class="code" href="dedos__threads_8c.html#a3c60433df66ec61cd178275f4231db3d">dedos_threads</a>[<a class="code" href="dedos__threads_8c.html#a705cb27a1ac6915760cf88cebba062ca">MAX_DEDOS_THREAD_ID</a> + 2];</div>
<div class="line"><a name="l00032"></a><span class="lineno"><a class="line" href="dedos__threads_8c.html#aecb0e59916f729a6b443d7bb30ae58b0">   32</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="dedos__threads_8c.html#aecb0e59916f729a6b443d7bb30ae58b0">pinned_cores</a>[<a class="code" href="dedos__threads_8c.html#a009855593b59738d24dbfc236edb3b14">MAX_CORES</a>];</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div>
<div class="line"><a name="l00034"></a><span class="lineno"><a class="line" href="dedos__threads_8c.html#afb032c6cebdf1139918c77512a8d5391">   34</a></span>&#160;<span class="keyword">enum</span> <a class="code" href="stat__ids_8h.html#ac210bd14ba53357098c0b3ebdd69784e">stat_id</a> <a class="code" href="dedos__threads_8c.html#afb032c6cebdf1139918c77512a8d5391">thread_stat_items</a>[] = {</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <a class="code" href="stat__ids_8h.html#ac210bd14ba53357098c0b3ebdd69784ea3c85d2952150487e586b3802e537ccbe">THREAD_UCPUTIME</a>,</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <a class="code" href="stat__ids_8h.html#ac210bd14ba53357098c0b3ebdd69784eaa63b74df8de1a0b9060b2a03a509dcca">THREAD_SCPUTIME</a>,</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    <a class="code" href="stat__ids_8h.html#ac210bd14ba53357098c0b3ebdd69784ea79748a810c4e5630689a4b1219617650">THREAD_MAXRSS</a>,</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <a class="code" href="stat__ids_8h.html#ac210bd14ba53357098c0b3ebdd69784ea6af8b8f31f19cb35feddf1d139f8e3f4">THREAD_MINFLT</a>,</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <a class="code" href="stat__ids_8h.html#ac210bd14ba53357098c0b3ebdd69784eada0624fa212ca4a497fd97a18bb1238f">THREAD_MAJFLT</a>,</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <a class="code" href="stat__ids_8h.html#ac210bd14ba53357098c0b3ebdd69784ea6cb62a4f93fea310ff9dbf5f0e1312c7">THREAD_VCSW</a>,</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <a class="code" href="stat__ids_8h.html#ac210bd14ba53357098c0b3ebdd69784ea2feb94c9d8936da27ab7e7f8c5e8f12b">THREAD_IVCSW</a></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;};</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div>
<div class="line"><a name="l00044"></a><span class="lineno"><a class="line" href="dedos__threads_8c.html#aa740056ba0da4148b051e08640e540f7">   44</a></span>&#160;<span class="preprocessor">#define N_THREAD_STAT_ITEMS sizeof(thread_stat_items) / sizeof(*thread_stat_items)</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00047"></a><span class="lineno"><a class="line" href="dedos__threads_8c.html#a113bd0ac8ad6e871cf4e2c713b6995a8">   47</a></span>&#160;<span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="dedos__threads_8c.html#a113bd0ac8ad6e871cf4e2c713b6995a8">init_thread_stat_items</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>) {</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i &lt; <a class="code" href="dedos__threads_8c.html#aa740056ba0da4148b051e08640e540f7">N_THREAD_STAT_ITEMS</a>; i++) {</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;        <a class="code" href="rt__stats_8c.html#a75d06b36d94388ed944b67baeb24c1e9">init_stat_item</a>(<a class="code" href="dedos__threads_8c.html#afb032c6cebdf1139918c77512a8d5391">thread_stat_items</a>[i], <span class="keywordtype">id</span>);</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    }</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;}</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div>
<div class="line"><a name="l00053"></a><span class="lineno"><a class="line" href="dedos__threads_8h.html#ad2be2a452f4ee946b74f926d9b885af6">   53</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structdedos__thread.html">dedos_thread</a> *<a class="code" href="dedos__threads_8c.html#ad2be2a452f4ee946b74f926d9b885af6">get_dedos_thread</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>) {</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="keywordflow">if</span> (<span class="keywordtype">id</span> == <a class="code" href="output__thread_8h.html#ae1a58cdf173436fc88c06c639f6e8cbb">OUTPUT_THREAD_ID</a>) {</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;        <span class="keywordtype">id</span> = <a class="code" href="dedos__threads_8c.html#a705cb27a1ac6915760cf88cebba062ca">MAX_DEDOS_THREAD_ID</a>;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keywordtype">id</span> &lt; 0) {</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;        <a class="code" href="logging_8h.html#a887f83dbb884a13949e4f2ad710e5ddf">log_error</a>(<span class="stringliteral">&quot;Dedos thread ID cannot be negative! Provided: %d&quot;</span>, <span class="keywordtype">id</span>);</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keywordtype">id</span> &gt; <a class="code" href="dedos__threads_8c.html#a705cb27a1ac6915760cf88cebba062ca">MAX_DEDOS_THREAD_ID</a>) {</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        <a class="code" href="logging_8h.html#a887f83dbb884a13949e4f2ad710e5ddf">log_error</a>(<span class="stringliteral">&quot;Requested thread ID too high. Maximum is %d&quot;</span>, <a class="code" href="dedos__threads_8c.html#a705cb27a1ac6915760cf88cebba062ca">MAX_DEDOS_THREAD_ID</a>);</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;        <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    }</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="keywordflow">if</span> (dedos_threads[<span class="keywordtype">id</span>] == NULL) {</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        <a class="code" href="logging_8h.html#a887f83dbb884a13949e4f2ad710e5ddf">log_error</a>(<span class="stringliteral">&quot;Dedos thread with id %d is not initialized&quot;</span>, <span class="keywordtype">id</span>);</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    }</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="keywordflow">return</span> dedos_threads[<a class="code" href="structdedos__thread.html#a9ec2f386c1e31415ee26e54c39f0f02a">id</a>];</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;}</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div>
<div class="line"><a name="l00073"></a><span class="lineno"><a class="line" href="dedos__threads_8c.html#a52b3a7e9424f741c06d541d059a47e98">   73</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="dedos__threads_8c.html#a52b3a7e9424f741c06d541d059a47e98">init_dedos_thread</a>(<span class="keyword">struct</span> <a class="code" href="structdedos__thread.html">dedos_thread</a> *thread,</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;                      <span class="keyword">enum</span> <a class="code" href="dfg_8h.html#a673ccd9aadafd31e8beaf16423c07db2">thread_mode</a> <a class="code" href="structdedos__thread.html#a70d31c1db4f14b59fd88148f5a4d8cbb">mode</a>,</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;                      <span class="keywordtype">int</span> <span class="keywordtype">id</span>) {</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    thread-&gt;<a class="code" href="structdedos__thread.html#a9ec2f386c1e31415ee26e54c39f0f02a">id</a> = <a class="code" href="structdedos__thread.html#a9ec2f386c1e31415ee26e54c39f0f02a">id</a>;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    thread-&gt;<a class="code" href="structdedos__thread.html#a70d31c1db4f14b59fd88148f5a4d8cbb">mode</a> = <a class="code" href="structdedos__thread.html#a70d31c1db4f14b59fd88148f5a4d8cbb">mode</a>;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    sem_init(&amp;thread-&gt;<a class="code" href="structdedos__thread.html#ababe14eb9fbd46f21932e27b04785973">sem</a>, 0, 0);</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    pthread_mutex_init(&amp;thread-&gt;<a class="code" href="structdedos__thread.html#abff71615fe6947f8fed5a26e198b6b4b">exit_lock</a>, NULL);</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    thread-&gt;<a class="code" href="structdedos__thread.html#ae1ad6c5ad2f9c080a1b396a8572e75f5">exit_signal</a> = 0;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <a class="code" href="dedos__threads_8c.html#a113bd0ac8ad6e871cf4e2c713b6995a8">init_thread_stat_items</a>(thread-&gt;<a class="code" href="structdedos__thread.html#a9ec2f386c1e31415ee26e54c39f0f02a">id</a>);</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="message__queue_8c.html#a475676d4d62424d511cd2ebb12919f37">init_msg_queue</a>(&amp;thread-&gt;<a class="code" href="structdedos__thread.html#ace61dc188bd6d8018126c508b1a42493">queue</a>, &amp;thread-&gt;<a class="code" href="structdedos__thread.html#ababe14eb9fbd46f21932e27b04785973">sem</a>) != 0) {</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        <a class="code" href="logging_8h.html#a887f83dbb884a13949e4f2ad710e5ddf">log_error</a>(<span class="stringliteral">&quot;Error initializing message queue for dedos thread&quot;</span>);</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    }</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <a class="code" href="logging_8h.html#a6688e6218820c9d155006dcab23eb611">log</a>(LOG_DEDOS_THREADS, <span class="stringliteral">&quot;Initialized thread %d (mode: %s, addr: %p)&quot;</span>,</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;               <span class="keywordtype">id</span>, mode == <a class="code" href="dfg_8h.html#a673ccd9aadafd31e8beaf16423c07db2ad7379b426f921781afd49485009640f0">PINNED_THREAD</a> ? <span class="stringliteral">&quot;pinned&quot;</span> : <span class="stringliteral">&quot;unpinned&quot;</span>, thread);</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="keywordflow">if</span> (<span class="keywordtype">id</span> == <a class="code" href="output__thread_8h.html#ae1a58cdf173436fc88c06c639f6e8cbb">OUTPUT_THREAD_ID</a>) {</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        <span class="keywordtype">id</span> = <a class="code" href="dedos__threads_8c.html#a56ecb7e9b922bd8793d20eaebf793be7">OUTPUT_THREAD_INDEX</a>;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    }</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    dedos_threads[<a class="code" href="structdedos__thread.html#a9ec2f386c1e31415ee26e54c39f0f02a">id</a>] = thread;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;}</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div>
<div class="line"><a name="l00099"></a><span class="lineno"><a class="line" href="structthread__init.html">   99</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structthread__init.html">thread_init</a> {</div>
<div class="line"><a name="l00100"></a><span class="lineno"><a class="line" href="structthread__init.html#abbea592e098189df8940eb597cb53ecc">  100</a></span>&#160;    <a class="code" href="dedos__threads_8h.html#abc395397d24e50b8932e864465a17aa5">dedos_thread_fn</a> <a class="code" href="structthread__init.html#abbea592e098189df8940eb597cb53ecc">thread_fn</a>;</div>
<div class="line"><a name="l00101"></a><span class="lineno"><a class="line" href="structthread__init.html#a3f5a046298ba770824a83f652ddbc7ae">  101</a></span>&#160;    <a class="code" href="dedos__threads_8h.html#a05cf7cb0c2d44afe48767196d7554f55">dedos_thread_init_fn</a> <a class="code" href="structthread__init.html#a3f5a046298ba770824a83f652ddbc7ae">init_fn</a>;</div>
<div class="line"><a name="l00102"></a><span class="lineno"><a class="line" href="structthread__init.html#a29d61655e6d0917cc7e0293a596b4e84">  102</a></span>&#160;    <a class="code" href="dedos__threads_8h.html#a8c7746e69f0ed91647b8d28e3e660c2a">dedos_thread_destroy_fn</a> <a class="code" href="structthread__init.html#a29d61655e6d0917cc7e0293a596b4e84">destroy_fn</a>;</div>
<div class="line"><a name="l00103"></a><span class="lineno"><a class="line" href="structthread__init.html#a35c0110fa8e8385bd0c6e823a7e5c30a">  103</a></span>&#160;    <span class="keyword">struct </span><a class="code" href="structdedos__thread.html">dedos_thread</a> *<span class="keyword">self</span>;</div>
<div class="line"><a name="l00104"></a><span class="lineno"><a class="line" href="structthread__init.html#a609ec6696aaa7d760a8154ddee7e8a49">  104</a></span>&#160;    sem_t <a class="code" href="structthread__init.html#a609ec6696aaa7d760a8154ddee7e8a49">sem</a>;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;};</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div>
<div class="line"><a name="l00108"></a><span class="lineno"><a class="line" href="dedos__threads_8c.html#a5e57e733d68866e6cfae829583da6f89">  108</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="dedos__threads_8c.html#a5e57e733d68866e6cfae829583da6f89">pin_thread</a>(pthread_t ptid) {</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="keywordtype">int</span> cpu_id;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="keywordtype">int</span> num_cpu = sysconf(_SC_NPROCESSORS_ONLN);</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="keywordflow">for</span> (cpu_id = 0; cpu_id &lt; num_cpu &amp;&amp; <a class="code" href="dedos__threads_8c.html#aecb0e59916f729a6b443d7bb30ae58b0">pinned_cores</a>[cpu_id] == 1; cpu_id++);</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="keywordflow">if</span> (cpu_id == num_cpu) {</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        <a class="code" href="logging_8h.html#afd2d22d45a6b32ff3ff8ea73013f09dc">log_warn</a>(<span class="stringliteral">&quot;No cores available to pin thread&quot;</span>);</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    }</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    cpu_set_t cpuset;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    CPU_ZERO(&amp;cpuset);</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    CPU_SET(cpu_id, &amp;cpuset);</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="keywordtype">int</span> s = pthread_setaffinity_np(ptid, <span class="keyword">sizeof</span>(cpuset), &amp;cpuset);</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="keywordflow">if</span> (s != 0) {</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        <a class="code" href="logging_8h.html#afd2d22d45a6b32ff3ff8ea73013f09dc">log_warn</a>(<span class="stringliteral">&quot;pthread_setaffinity_np returned error %d&quot;</span>, s);</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    }</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    pinned_cores[cpu_id] = 1;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <a class="code" href="logging_8h.html#a6688e6218820c9d155006dcab23eb611">log</a>(LOG_DEDOS_THREADS, <span class="stringliteral">&quot;Successfully pinned pthread %d&quot;</span>, (<span class="keywordtype">int</span>)ptid);</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;}</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div>
<div class="line"><a name="l00130"></a><span class="lineno"><a class="line" href="dedos__threads_8h.html#a97563d2c123c5d0c52088ae62c69dc7e">  130</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="dedos__threads_8c.html#a97563d2c123c5d0c52088ae62c69dc7e">dedos_thread_stop</a>(<span class="keyword">struct</span> <a class="code" href="structdedos__thread.html">dedos_thread</a> *thread) {</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <a class="code" href="logging_8h.html#a442f23202cd03383ed8e3ec6bbae5bd2">log_info</a>(<span class="stringliteral">&quot;Signaling thread %d to exit&quot;</span>, thread-&gt;<a class="code" href="structdedos__thread.html#a9ec2f386c1e31415ee26e54c39f0f02a">id</a>);</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    pthread_mutex_lock(&amp;thread-&gt;<a class="code" href="structdedos__thread.html#abff71615fe6947f8fed5a26e198b6b4b">exit_lock</a>);</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    thread-&gt;<a class="code" href="structdedos__thread.html#ae1ad6c5ad2f9c080a1b396a8572e75f5">exit_signal</a> = 1;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    sem_post(&amp;thread-&gt;<a class="code" href="structdedos__thread.html#ababe14eb9fbd46f21932e27b04785973">sem</a>);</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    pthread_mutex_unlock(&amp;thread-&gt;<a class="code" href="structdedos__thread.html#abff71615fe6947f8fed5a26e198b6b4b">exit_lock</a>);</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;}</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;</div>
<div class="line"><a name="l00139"></a><span class="lineno"><a class="line" href="dedos__threads_8h.html#a8149e98a49e985082afb18b9fe30e94d">  139</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="dedos__threads_8c.html#a8149e98a49e985082afb18b9fe30e94d">dedos_thread_join</a>(<span class="keyword">struct</span> <a class="code" href="structdedos__thread.html">dedos_thread</a> *thread) {</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    pthread_join(thread-&gt;<a class="code" href="structdedos__thread.html#a7a40b7dea35c3ebfb87974126bdd52f8">pthread</a>, NULL);</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    free(thread);</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;}</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div>
<div class="line"><a name="l00144"></a><span class="lineno"><a class="line" href="dedos__threads_8h.html#a84fe48f8c905bad9ee99509742472900">  144</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="dedos__threads_8c.html#a84fe48f8c905bad9ee99509742472900">dedos_thread_should_exit</a>(<span class="keyword">struct</span> <a class="code" href="structdedos__thread.html">dedos_thread</a> *thread) {</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    pthread_mutex_lock(&amp;thread-&gt;<a class="code" href="structdedos__thread.html#abff71615fe6947f8fed5a26e198b6b4b">exit_lock</a>);</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="structdedos__thread.html#ae1ad6c5ad2f9c080a1b396a8572e75f5">exit_signal</a> = thread-&gt;<a class="code" href="structdedos__thread.html#ae1ad6c5ad2f9c080a1b396a8572e75f5">exit_signal</a>;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    pthread_mutex_unlock(&amp;thread-&gt;<a class="code" href="structdedos__thread.html#abff71615fe6947f8fed5a26e198b6b4b">exit_lock</a>);</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="structdedos__thread.html#ae1ad6c5ad2f9c080a1b396a8572e75f5">exit_signal</a>;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;}</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;</div>
<div class="line"><a name="l00157"></a><span class="lineno"><a class="line" href="dedos__threads_8c.html#a2035e21970dd9c3b7ce4465805a1cfcd">  157</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="dedos__threads_8c.html#a2035e21970dd9c3b7ce4465805a1cfcd">dedos_thread_starter</a>(<span class="keywordtype">void</span> *thread_init_v) {</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="keyword">struct </span><a class="code" href="structthread__init.html">thread_init</a> *init = thread_init_v;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="comment">// Have to get things out of the thread_init, because</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="comment">// it will be destroyed externally once sem_post() is complete</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="keyword">struct </span><a class="code" href="structdedos__thread.html">dedos_thread</a> *thread = init-&gt;<a class="code" href="structthread__init.html#a35c0110fa8e8385bd0c6e823a7e5c30a">self</a>;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <a class="code" href="dedos__threads_8h.html#abc395397d24e50b8932e864465a17aa5">dedos_thread_fn</a> thread_fn = init-&gt;<a class="code" href="structthread__init.html#abbea592e098189df8940eb597cb53ecc">thread_fn</a>;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <a class="code" href="dedos__threads_8h.html#a8c7746e69f0ed91647b8d28e3e660c2a">dedos_thread_destroy_fn</a> destroy_fn = init-&gt;<a class="code" href="structthread__init.html#a29d61655e6d0917cc7e0293a596b4e84">destroy_fn</a>;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="keywordtype">void</span> *init_rtn = NULL;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="keywordflow">if</span> (init-&gt;<a class="code" href="structthread__init.html#a3f5a046298ba770824a83f652ddbc7ae">init_fn</a>) {</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        init_rtn = init-&gt;<a class="code" href="structthread__init.html#a3f5a046298ba770824a83f652ddbc7ae">init_fn</a>(thread);</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    }</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="keywordflow">if</span> (thread-&gt;<a class="code" href="structdedos__thread.html#a70d31c1db4f14b59fd88148f5a4d8cbb">mode</a> == <a class="code" href="dfg_8h.html#a673ccd9aadafd31e8beaf16423c07db2ad7379b426f921781afd49485009640f0">PINNED_THREAD</a>) {</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="dedos__threads_8c.html#a5e57e733d68866e6cfae829583da6f89">pin_thread</a>(thread-&gt;<a class="code" href="structdedos__thread.html#a7a40b7dea35c3ebfb87974126bdd52f8">pthread</a>) != 0) {</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;            <a class="code" href="logging_8h.html#afd2d22d45a6b32ff3ff8ea73013f09dc">log_warn</a>(<span class="stringliteral">&quot;Could not pin thread %d&quot;</span>, thread-&gt;<a class="code" href="structdedos__thread.html#a9ec2f386c1e31415ee26e54c39f0f02a">id</a>);</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        }</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    }</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    sem_post(&amp;init-&gt;<a class="code" href="structthread__init.html#a609ec6696aaa7d760a8154ddee7e8a49">sem</a>);</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <a class="code" href="logging_8h.html#a6688e6218820c9d155006dcab23eb611">log</a>(LOG_DEDOS_THREADS, <span class="stringliteral">&quot;Started thread %d (mode: %s, addr: %p)&quot;</span>,</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;               thread-&gt;<a class="code" href="structdedos__thread.html#a9ec2f386c1e31415ee26e54c39f0f02a">id</a>, thread-&gt; <a class="code" href="structdedos__thread.html#a70d31c1db4f14b59fd88148f5a4d8cbb">mode</a> == <a class="code" href="dfg_8h.html#a673ccd9aadafd31e8beaf16423c07db2ad7379b426f921781afd49485009640f0">PINNED_THREAD</a> ? <span class="stringliteral">&quot;pinned&quot;</span> : <span class="stringliteral">&quot;unpinned&quot;</span>, thread);</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="keywordtype">int</span> rtn = thread_fn(thread, init_rtn);</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <a class="code" href="logging_8h.html#a6688e6218820c9d155006dcab23eb611">log</a>(LOG_DEDOS_THREADS, <span class="stringliteral">&quot;Thread %d ended.&quot;</span>, thread-&gt;<a class="code" href="structdedos__thread.html#a9ec2f386c1e31415ee26e54c39f0f02a">id</a>);</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    <span class="keywordflow">if</span> (destroy_fn) {</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        destroy_fn(thread, init_rtn);</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    }</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="keywordflow">return</span> (<span class="keywordtype">void</span>*)(intptr_t)rtn;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;}</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div>
<div class="line"><a name="l00191"></a><span class="lineno"><a class="line" href="dedos__threads_8c.html#adccaa8b29bf590e9e04c14d1943c89ac">  191</a></span>&#160;<span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="dedos__threads_8c.html#adccaa8b29bf590e9e04c14d1943c89ac">gather_thread_metrics</a>(<span class="keyword">struct</span> <a class="code" href="structdedos__thread.html">dedos_thread</a> *thread) {</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="keyword">struct </span>rusage usage;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="keywordtype">int</span> rtn = getrusage(RUSAGE_THREAD, &amp;usage);</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="keywordflow">if</span> (rtn &lt; 0) {</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        <a class="code" href="logging_8h.html#a887f83dbb884a13949e4f2ad710e5ddf">log_error</a>(<span class="stringliteral">&quot;Error getting thread %d rusage&quot;</span>, thread-&gt;<a class="code" href="structdedos__thread.html#a9ec2f386c1e31415ee26e54c39f0f02a">id</a>);</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    }</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="keywordtype">int</span> <span class="keywordtype">id</span> = thread-&gt;<a class="code" href="structdedos__thread.html#a9ec2f386c1e31415ee26e54c39f0f02a">id</a>;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <a class="code" href="rt__stats_8c.html#ab992698ed0b92b65824db71f24e09c29">record_stat</a>(<a class="code" href="stat__ids_8h.html#ac210bd14ba53357098c0b3ebdd69784ea3c85d2952150487e586b3802e537ccbe">THREAD_UCPUTIME</a>, <span class="keywordtype">id</span>, (<span class="keywordtype">double</span>)usage.ru_utime.tv_sec * 1e6 + usage.ru_utime.tv_usec, 1);</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <a class="code" href="rt__stats_8c.html#ab992698ed0b92b65824db71f24e09c29">record_stat</a>(<a class="code" href="stat__ids_8h.html#ac210bd14ba53357098c0b3ebdd69784eaa63b74df8de1a0b9060b2a03a509dcca">THREAD_SCPUTIME</a>, <span class="keywordtype">id</span>, (<span class="keywordtype">double</span>)usage.ru_stime.tv_sec * 1e6 + usage.ru_stime.tv_usec, 1);</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <a class="code" href="rt__stats_8c.html#ab992698ed0b92b65824db71f24e09c29">record_stat</a>(<a class="code" href="stat__ids_8h.html#ac210bd14ba53357098c0b3ebdd69784ea79748a810c4e5630689a4b1219617650">THREAD_MAXRSS</a>, <span class="keywordtype">id</span>, usage.ru_maxrss, 0);</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <a class="code" href="rt__stats_8c.html#ab992698ed0b92b65824db71f24e09c29">record_stat</a>(<a class="code" href="stat__ids_8h.html#ac210bd14ba53357098c0b3ebdd69784ea6af8b8f31f19cb35feddf1d139f8e3f4">THREAD_MINFLT</a>, <span class="keywordtype">id</span>, usage.ru_minflt, 0);</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <a class="code" href="rt__stats_8c.html#ab992698ed0b92b65824db71f24e09c29">record_stat</a>(<a class="code" href="stat__ids_8h.html#ac210bd14ba53357098c0b3ebdd69784eada0624fa212ca4a497fd97a18bb1238f">THREAD_MAJFLT</a>, <span class="keywordtype">id</span>, usage.ru_majflt, 0);</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <a class="code" href="rt__stats_8c.html#ab992698ed0b92b65824db71f24e09c29">record_stat</a>(<a class="code" href="stat__ids_8h.html#ac210bd14ba53357098c0b3ebdd69784ea6cb62a4f93fea310ff9dbf5f0e1312c7">THREAD_VCSW</a>, <span class="keywordtype">id</span>, usage.ru_nvcsw, 1);</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <a class="code" href="rt__stats_8c.html#ab992698ed0b92b65824db71f24e09c29">record_stat</a>(<a class="code" href="stat__ids_8h.html#ac210bd14ba53357098c0b3ebdd69784ea2feb94c9d8936da27ab7e7f8c5e8f12b">THREAD_IVCSW</a>, <span class="keywordtype">id</span>, usage.ru_nivcsw, 1);</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;}</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div>
<div class="line"><a name="l00211"></a><span class="lineno"><a class="line" href="dedos__threads_8c.html#aca31b6b12493c91f78b00950c95c9bf8">  211</a></span>&#160;<span class="preprocessor">#define DEFAULT_WAIT_TIMEOUT_S 1</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00213"></a><span class="lineno"><a class="line" href="dedos__threads_8c.html#a003e2bee2ab0f27a9d2bfec847b30393">  213</a></span>&#160;<span class="preprocessor">#define MAX_METRIC_INTERVAL_MS 500</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00215"></a><span class="lineno"><a class="line" href="dedos__threads_8h.html#a0e9f00b60e6fbcefadacb5f430abf8aa">  215</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="dedos__threads_8c.html#a0e9f00b60e6fbcefadacb5f430abf8aa">thread_wait</a>(<span class="keyword">struct</span> <a class="code" href="structdedos__thread.html">dedos_thread</a> *thread, <span class="keyword">struct</span> timespec *abs_timeout) {</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <span class="keywordtype">int</span> rtn = sem_trywait(&amp;thread-&gt;<a class="code" href="structdedos__thread.html#ababe14eb9fbd46f21932e27b04785973">sem</a>);</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <span class="keywordflow">if</span> (rtn == 0) {</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        <span class="keyword">struct </span>timespec cur_time;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        clock_gettime(CLOCK_REALTIME_COARSE, &amp;cur_time);</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        <span class="keywordflow">if</span> (cur_time.tv_sec * 1e3 + cur_time.tv_nsec / 1e6 &gt; \</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                thread-&gt;<a class="code" href="structdedos__thread.html#aa45d04173d89640ec2ddeb95c66db84e">last_metric</a>.tv_sec * 1e3 + thread-&gt;<a class="code" href="structdedos__thread.html#aa45d04173d89640ec2ddeb95c66db84e">last_metric</a>.tv_nsec / 1e6 + \</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                <a class="code" href="dedos__threads_8c.html#a003e2bee2ab0f27a9d2bfec847b30393">MAX_METRIC_INTERVAL_MS</a>) {</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;            <a class="code" href="dedos__threads_8c.html#adccaa8b29bf590e9e04c14d1943c89ac">gather_thread_metrics</a>(thread);</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;            thread-&gt;<a class="code" href="structdedos__thread.html#aa45d04173d89640ec2ddeb95c66db84e">last_metric</a> = <a class="code" href="worker__thread_8c.html#aca6807273671d50c81ae472c0ccff882">cur_time</a>;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        }</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rtn == -1 &amp;&amp; errno == EAGAIN) {</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        <a class="code" href="dedos__threads_8c.html#adccaa8b29bf590e9e04c14d1943c89ac">gather_thread_metrics</a>(thread);</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        clock_gettime(CLOCK_REALTIME_COARSE, &amp;thread-&gt;<a class="code" href="structdedos__thread.html#aa45d04173d89640ec2ddeb95c66db84e">last_metric</a>);</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    }</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <span class="keywordflow">if</span> (abs_timeout == NULL) {</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        <span class="keyword">struct </span>timespec cur_time;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        clock_gettime(CLOCK_REALTIME_COARSE, &amp;cur_time);</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        cur_time.tv_sec += <a class="code" href="dedos__threads_8c.html#aca31b6b12493c91f78b00950c95c9bf8">DEFAULT_WAIT_TIMEOUT_S</a>;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        rtn = sem_timedwait(&amp;thread-&gt;<a class="code" href="structdedos__thread.html#ababe14eb9fbd46f21932e27b04785973">sem</a>, &amp;cur_time);</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        rtn = sem_timedwait(&amp;thread-&gt;<a class="code" href="structdedos__thread.html#ababe14eb9fbd46f21932e27b04785973">sem</a>, abs_timeout);</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    }</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="keywordflow">if</span> (rtn &lt; 0 &amp;&amp; errno != ETIMEDOUT) {</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        <a class="code" href="logging_8h.html#a0cacd3ee0d2548c976984591088f19a7">log_perror</a>(<span class="stringliteral">&quot;Error waiting on thread semaphore&quot;</span>);</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        exit(-1);</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    }</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;}</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;</div>
<div class="line"><a name="l00250"></a><span class="lineno"><a class="line" href="dedos__threads_8h.html#aa336318af10f81d18bfd2ea9fb0ce45d">  250</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="dedos__threads_8c.html#aa336318af10f81d18bfd2ea9fb0ce45d">start_dedos_thread</a>(<a class="code" href="dedos__threads_8h.html#abc395397d24e50b8932e864465a17aa5">dedos_thread_fn</a> thread_fn,</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                       <a class="code" href="dedos__threads_8h.html#a05cf7cb0c2d44afe48767196d7554f55">dedos_thread_init_fn</a> init_fn,</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                       <a class="code" href="dedos__threads_8h.html#a8c7746e69f0ed91647b8d28e3e660c2a">dedos_thread_destroy_fn</a> destroy_fn,</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                       <span class="keyword">enum</span> <a class="code" href="dfg_8h.html#af31ca3002c5b769551da6f1183bafed5">blocking_mode</a> mode,</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                       <span class="keywordtype">int</span> <span class="keywordtype">id</span>,</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                       <span class="keyword">struct</span> <a class="code" href="structdedos__thread.html">dedos_thread</a> *thread) {</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="keywordflow">if</span> (<span class="keywordtype">id</span> == <a class="code" href="output__thread_8h.html#ae1a58cdf173436fc88c06c639f6e8cbb">OUTPUT_THREAD_ID</a>) {</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        <span class="keywordtype">id</span> = <a class="code" href="dedos__threads_8c.html#a705cb27a1ac6915760cf88cebba062ca">MAX_DEDOS_THREAD_ID</a>;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    }</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <span class="keywordtype">int</span> rtn = <a class="code" href="dedos__threads_8c.html#a52b3a7e9424f741c06d541d059a47e98">init_dedos_thread</a>(thread, mode, <span class="keywordtype">id</span>);</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="keyword">struct </span><a class="code" href="structthread__init.html">thread_init</a> init = {</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        .<a class="code" href="structthread__init.html#abbea592e098189df8940eb597cb53ecc">thread_fn</a> = <a class="code" href="structthread__init.html#abbea592e098189df8940eb597cb53ecc">thread_fn</a>,</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        .init_fn = <a class="code" href="structthread__init.html#a3f5a046298ba770824a83f652ddbc7ae">init_fn</a>,</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        .destroy_fn = <a class="code" href="structthread__init.html#a29d61655e6d0917cc7e0293a596b4e84">destroy_fn</a>,</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        .self = thread</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    };</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="keywordflow">if</span> (sem_init(&amp;init.<a class="code" href="structthread__init.html#a609ec6696aaa7d760a8154ddee7e8a49">sem</a>, 0, 0)) {</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        <a class="code" href="logging_8h.html#a0cacd3ee0d2548c976984591088f19a7">log_perror</a>(<span class="stringliteral">&quot;Error initializing semaphore for dedos thread&quot;</span>);</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    }</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <a class="code" href="logging_8h.html#a6688e6218820c9d155006dcab23eb611">log</a>(LOG_DEDOS_THREADS, <span class="stringliteral">&quot;Waiting on thread %d to start&quot;</span>, <span class="keywordtype">id</span>);</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    rtn = pthread_create(&amp;thread-&gt;<a class="code" href="structdedos__thread.html#a7a40b7dea35c3ebfb87974126bdd52f8">pthread</a>, NULL,</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                         <a class="code" href="dedos__threads_8c.html#a2035e21970dd9c3b7ce4465805a1cfcd">dedos_thread_starter</a>, (<span class="keywordtype">void</span>*)&amp;init);</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <span class="keywordflow">if</span> (rtn &lt; 0) {</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        <a class="code" href="logging_8h.html#a887f83dbb884a13949e4f2ad710e5ddf">log_error</a>(<span class="stringliteral">&quot;pthread_create failed with errno: %d&quot;</span>, rtn);</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    }</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    <span class="keywordflow">if</span> (sem_wait(&amp;init.<a class="code" href="structthread__init.html#a609ec6696aaa7d760a8154ddee7e8a49">sem</a>) != 0) {</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        <a class="code" href="logging_8h.html#a0cacd3ee0d2548c976984591088f19a7">log_perror</a>(<span class="stringliteral">&quot;Error waiting on thread start semaphore&quot;</span>);</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    }</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <a class="code" href="logging_8h.html#a6688e6218820c9d155006dcab23eb611">log</a>(LOG_DEDOS_THREADS, <span class="stringliteral">&quot;Thread %d started successfully&quot;</span>, <span class="keywordtype">id</span>);</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    sem_destroy(&amp;init.<a class="code" href="structthread__init.html#a609ec6696aaa7d760a8154ddee7e8a49">sem</a>);</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;}</div>
<div class="ttc" id="structthread__init_html_abbea592e098189df8940eb597cb53ecc"><div class="ttname"><a href="structthread__init.html#abbea592e098189df8940eb597cb53ecc">thread_init::thread_fn</a></div><div class="ttdeci">dedos_thread_fn thread_fn</div><div class="ttdef"><b>Definition:</b> <a href="dedos__threads_8c_source.html#l00100">dedos_threads.c:100</a></div></div>
<div class="ttc" id="rt__stats_8h_html"><div class="ttname"><a href="rt__stats_8h.html">rt_stats.h</a></div><div class="ttdoc">Collecting statistics within the runtime. </div></div>
<div class="ttc" id="dedos__threads_8c_html_a5e57e733d68866e6cfae829583da6f89"><div class="ttname"><a href="dedos__threads_8c.html#a5e57e733d68866e6cfae829583da6f89">pin_thread</a></div><div class="ttdeci">static int pin_thread(pthread_t ptid)</div><div class="ttdoc">Pins the thread with the pthread id ptid to the first unused core. </div><div class="ttdef"><b>Definition:</b> <a href="dedos__threads_8c_source.html#l00108">dedos_threads.c:108</a></div></div>
<div class="ttc" id="dfg_8h_html_a673ccd9aadafd31e8beaf16423c07db2"><div class="ttname"><a href="dfg_8h.html#a673ccd9aadafd31e8beaf16423c07db2">thread_mode</a></div><div class="ttdeci">thread_mode</div><div class="ttdoc">Identifies if a thread is pinned to a core or able to be scheduled on any core. </div><div class="ttdef"><b>Definition:</b> <a href="dfg_8h_source.html#l00072">dfg.h:72</a></div></div>
<div class="ttc" id="stat__ids_8h_html_ac210bd14ba53357098c0b3ebdd69784eada0624fa212ca4a497fd97a18bb1238f"><div class="ttname"><a href="stat__ids_8h.html#ac210bd14ba53357098c0b3ebdd69784eada0624fa212ca4a497fd97a18bb1238f">THREAD_MAJFLT</a></div><div class="ttdef"><b>Definition:</b> <a href="stat__ids_8h_source.html#l00024">stat_ids.h:24</a></div></div>
<div class="ttc" id="thread__message_8h_html"><div class="ttname"><a href="thread__message_8h.html">thread_message.h</a></div><div class="ttdoc">Messages to be delivered to dedos_threads. </div></div>
<div class="ttc" id="logging_8h_html_a442f23202cd03383ed8e3ec6bbae5bd2"><div class="ttname"><a href="logging_8h.html#a442f23202cd03383ed8e3ec6bbae5bd2">log_info</a></div><div class="ttdeci">#define log_info(fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00069">logging.h:69</a></div></div>
<div class="ttc" id="dedos__threads_8c_html_a009855593b59738d24dbfc236edb3b14"><div class="ttname"><a href="dedos__threads_8c.html#a009855593b59738d24dbfc236edb3b14">MAX_CORES</a></div><div class="ttdeci">#define MAX_CORES</div><div class="ttdoc">The maximum number of cores that can be present on a node. </div><div class="ttdef"><b>Definition:</b> <a href="dedos__threads_8c_source.html#l00024">dedos_threads.c:24</a></div></div>
<div class="ttc" id="dedos__threads_8c_html_adccaa8b29bf590e9e04c14d1943c89ac"><div class="ttname"><a href="dedos__threads_8c.html#adccaa8b29bf590e9e04c14d1943c89ac">gather_thread_metrics</a></div><div class="ttdeci">static void gather_thread_metrics(struct dedos_thread *thread)</div><div class="ttdef"><b>Definition:</b> <a href="dedos__threads_8c_source.html#l00191">dedos_threads.c:191</a></div></div>
<div class="ttc" id="structthread__init_html_a3f5a046298ba770824a83f652ddbc7ae"><div class="ttname"><a href="structthread__init.html#a3f5a046298ba770824a83f652ddbc7ae">thread_init::init_fn</a></div><div class="ttdeci">dedos_thread_init_fn init_fn</div><div class="ttdef"><b>Definition:</b> <a href="dedos__threads_8c_source.html#l00101">dedos_threads.c:101</a></div></div>
<div class="ttc" id="structdedos__thread_html_ae1ad6c5ad2f9c080a1b396a8572e75f5"><div class="ttname"><a href="structdedos__thread.html#ae1ad6c5ad2f9c080a1b396a8572e75f5">dedos_thread::exit_signal</a></div><div class="ttdeci">int exit_signal</div><div class="ttdoc">For checking if thread should exit. </div><div class="ttdef"><b>Definition:</b> <a href="dedos__threads_8h_source.html#l00030">dedos_threads.h:30</a></div></div>
<div class="ttc" id="structdedos__thread_html_aa45d04173d89640ec2ddeb95c66db84e"><div class="ttname"><a href="structdedos__thread.html#aa45d04173d89640ec2ddeb95c66db84e">dedos_thread::last_metric</a></div><div class="ttdeci">struct timespec last_metric</div><div class="ttdoc">For logging thread metrics. </div><div class="ttdef"><b>Definition:</b> <a href="dedos__threads_8h_source.html#l00032">dedos_threads.h:32</a></div></div>
<div class="ttc" id="dedos__threads_8c_html_a113bd0ac8ad6e871cf4e2c713b6995a8"><div class="ttname"><a href="dedos__threads_8c.html#a113bd0ac8ad6e871cf4e2c713b6995a8">init_thread_stat_items</a></div><div class="ttdeci">static void init_thread_stat_items(int id)</div><div class="ttdoc">Initilizes the stat items associated with a thread. </div><div class="ttdef"><b>Definition:</b> <a href="dedos__threads_8c_source.html#l00047">dedos_threads.c:47</a></div></div>
<div class="ttc" id="structdedos__thread_html_a70d31c1db4f14b59fd88148f5a4d8cbb"><div class="ttname"><a href="structdedos__thread.html#a70d31c1db4f14b59fd88148f5a4d8cbb">dedos_thread::mode</a></div><div class="ttdeci">enum thread_mode mode</div><div class="ttdoc">[un]pinned </div><div class="ttdef"><b>Definition:</b> <a href="dedos__threads_8h_source.html#l00022">dedos_threads.h:22</a></div></div>
<div class="ttc" id="stat__ids_8h_html_ac210bd14ba53357098c0b3ebdd69784eaa63b74df8de1a0b9060b2a03a509dcca"><div class="ttname"><a href="stat__ids_8h.html#ac210bd14ba53357098c0b3ebdd69784eaa63b74df8de1a0b9060b2a03a509dcca">THREAD_SCPUTIME</a></div><div class="ttdef"><b>Definition:</b> <a href="stat__ids_8h_source.html#l00021">stat_ids.h:21</a></div></div>
<div class="ttc" id="stat__ids_8h_html_ac210bd14ba53357098c0b3ebdd69784e"><div class="ttname"><a href="stat__ids_8h.html#ac210bd14ba53357098c0b3ebdd69784e">stat_id</a></div><div class="ttdeci">stat_id</div><div class="ttdoc">The identifiers with which stats can be logged. </div><div class="ttdef"><b>Definition:</b> <a href="stat__ids_8h_source.html#l00013">stat_ids.h:13</a></div></div>
<div class="ttc" id="structdedos__thread_html_abff71615fe6947f8fed5a26e198b6b4b"><div class="ttname"><a href="structdedos__thread.html#abff71615fe6947f8fed5a26e198b6b4b">dedos_thread::exit_lock</a></div><div class="ttdeci">pthread_mutex_t exit_lock</div><div class="ttdoc">For checking if thread should exit. </div><div class="ttdef"><b>Definition:</b> <a href="dedos__threads_8h_source.html#l00028">dedos_threads.h:28</a></div></div>
<div class="ttc" id="structdedos__thread_html_a7a40b7dea35c3ebfb87974126bdd52f8"><div class="ttname"><a href="structdedos__thread.html#a7a40b7dea35c3ebfb87974126bdd52f8">dedos_thread::pthread</a></div><div class="ttdeci">pthread_t pthread</div><div class="ttdoc">The underlying pthread. </div><div class="ttdef"><b>Definition:</b> <a href="dedos__threads_8h_source.html#l00018">dedos_threads.h:18</a></div></div>
<div class="ttc" id="logging_8h_html_a0cacd3ee0d2548c976984591088f19a7"><div class="ttname"><a href="logging_8h.html#a0cacd3ee0d2548c976984591088f19a7">log_perror</a></div><div class="ttdeci">#define log_perror(fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00083">logging.h:83</a></div></div>
<div class="ttc" id="worker__thread_8c_html_aca6807273671d50c81ae472c0ccff882"><div class="ttname"><a href="worker__thread_8c.html#aca6807273671d50c81ae472c0ccff882">cur_time</a></div><div class="ttdeci">static struct timespec cur_time</div><div class="ttdoc">Static structure for holding current time, so it can be returned from next_timeout. </div><div class="ttdef"><b>Definition:</b> <a href="worker__thread_8c_source.html#l00256">worker_thread.c:256</a></div></div>
<div class="ttc" id="logging_8h_html"><div class="ttname"><a href="logging_8h.html">logging.h</a></div><div class="ttdoc">Logging of status messages to the terminal. </div></div>
<div class="ttc" id="dedos__threads_8c_html_a0e9f00b60e6fbcefadacb5f430abf8aa"><div class="ttname"><a href="dedos__threads_8c.html#a0e9f00b60e6fbcefadacb5f430abf8aa">thread_wait</a></div><div class="ttdeci">int thread_wait(struct dedos_thread *thread, struct timespec *abs_timeout)</div><div class="ttdoc">To be called from the thread, causes it to wait until a message has been received or the timeout has ...</div><div class="ttdef"><b>Definition:</b> <a href="dedos__threads_8c_source.html#l00215">dedos_threads.c:215</a></div></div>
<div class="ttc" id="dedos__threads_8c_html_a56ecb7e9b922bd8793d20eaebf793be7"><div class="ttname"><a href="dedos__threads_8c.html#a56ecb7e9b922bd8793d20eaebf793be7">OUTPUT_THREAD_INDEX</a></div><div class="ttdeci">#define OUTPUT_THREAD_INDEX</div><div class="ttdoc">The index at which to store the dedos_thread handling sending messages. </div><div class="ttdef"><b>Definition:</b> <a href="dedos__threads_8c_source.html#l00027">dedos_threads.c:27</a></div></div>
<div class="ttc" id="stat__ids_8h_html_ac210bd14ba53357098c0b3ebdd69784ea2feb94c9d8936da27ab7e7f8c5e8f12b"><div class="ttname"><a href="stat__ids_8h.html#ac210bd14ba53357098c0b3ebdd69784ea2feb94c9d8936da27ab7e7f8c5e8f12b">THREAD_IVCSW</a></div><div class="ttdef"><b>Definition:</b> <a href="stat__ids_8h_source.html#l00026">stat_ids.h:26</a></div></div>
<div class="ttc" id="stat__ids_8h_html_ac210bd14ba53357098c0b3ebdd69784ea79748a810c4e5630689a4b1219617650"><div class="ttname"><a href="stat__ids_8h.html#ac210bd14ba53357098c0b3ebdd69784ea79748a810c4e5630689a4b1219617650">THREAD_MAXRSS</a></div><div class="ttdef"><b>Definition:</b> <a href="stat__ids_8h_source.html#l00022">stat_ids.h:22</a></div></div>
<div class="ttc" id="dedos__threads_8h_html"><div class="ttname"><a href="dedos__threads_8h.html">dedos_threads.h</a></div><div class="ttdoc">Control spawned threads with message queue within DeDOS. </div></div>
<div class="ttc" id="dedos__threads_8c_html_aecb0e59916f729a6b443d7bb30ae58b0"><div class="ttname"><a href="dedos__threads_8c.html#aecb0e59916f729a6b443d7bb30ae58b0">pinned_cores</a></div><div class="ttdeci">static int pinned_cores[16]</div><div class="ttdoc">Keep track of which cores have been assigned to threads. </div><div class="ttdef"><b>Definition:</b> <a href="dedos__threads_8c_source.html#l00032">dedos_threads.c:32</a></div></div>
<div class="ttc" id="dedos__threads_8c_html_a97563d2c123c5d0c52088ae62c69dc7e"><div class="ttname"><a href="dedos__threads_8c.html#a97563d2c123c5d0c52088ae62c69dc7e">dedos_thread_stop</a></div><div class="ttdeci">void dedos_thread_stop(struct dedos_thread *thread)</div><div class="ttdoc">Sets the exit signal for a thread, causing the main loop to quit. </div><div class="ttdef"><b>Definition:</b> <a href="dedos__threads_8c_source.html#l00130">dedos_threads.c:130</a></div></div>
<div class="ttc" id="logging_8h_html_a887f83dbb884a13949e4f2ad710e5ddf"><div class="ttname"><a href="logging_8h.html#a887f83dbb884a13949e4f2ad710e5ddf">log_error</a></div><div class="ttdeci">#define log_error(fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00082">logging.h:82</a></div></div>
<div class="ttc" id="rt__stats_8c_html_a75d06b36d94388ed944b67baeb24c1e9"><div class="ttname"><a href="rt__stats_8c.html#a75d06b36d94388ed944b67baeb24c1e9">init_stat_item</a></div><div class="ttdeci">int init_stat_item(enum stat_id stat_id, unsigned int item_id)</div><div class="ttdoc">Initializes a stat item so that statistics can be logged to it. </div><div class="ttdef"><b>Definition:</b> <a href="rt__stats_8c_source.html#l00695">rt_stats.c:695</a></div></div>
<div class="ttc" id="structdedos__thread_html_a9ec2f386c1e31415ee26e54c39f0f02a"><div class="ttname"><a href="structdedos__thread.html#a9ec2f386c1e31415ee26e54c39f0f02a">dedos_thread::id</a></div><div class="ttdeci">int id</div><div class="ttdoc">A unique identifier for the thread. </div><div class="ttdef"><b>Definition:</b> <a href="dedos__threads_8h_source.html#l00020">dedos_threads.h:20</a></div></div>
<div class="ttc" id="dfg_8h_html_af31ca3002c5b769551da6f1183bafed5"><div class="ttname"><a href="dfg_8h.html#af31ca3002c5b769551da6f1183bafed5">blocking_mode</a></div><div class="ttdeci">blocking_mode</div><div class="ttdoc">Whether an MSU is blocking or non-blocking. </div><div class="ttdef"><b>Definition:</b> <a href="dfg_8h_source.html#l00142">dfg.h:142</a></div></div>
<div class="ttc" id="structthread__init_html"><div class="ttname"><a href="structthread__init.html">thread_init</a></div><div class="ttdoc">Structure which holds the initialization info for a dedos_thread. </div><div class="ttdef"><b>Definition:</b> <a href="dedos__threads_8c_source.html#l00099">dedos_threads.c:99</a></div></div>
<div class="ttc" id="output__thread_8h_html"><div class="ttname"><a href="output__thread_8h.html">output_thread.h</a></div><div class="ttdoc">A dedos_thread which monitors a queue for output to be sent to other runtimes or the global controlle...</div></div>
<div class="ttc" id="stat__ids_8h_html_ac210bd14ba53357098c0b3ebdd69784ea6af8b8f31f19cb35feddf1d139f8e3f4"><div class="ttname"><a href="stat__ids_8h.html#ac210bd14ba53357098c0b3ebdd69784ea6af8b8f31f19cb35feddf1d139f8e3f4">THREAD_MINFLT</a></div><div class="ttdef"><b>Definition:</b> <a href="stat__ids_8h_source.html#l00023">stat_ids.h:23</a></div></div>
<div class="ttc" id="structthread__init_html_a609ec6696aaa7d760a8154ddee7e8a49"><div class="ttname"><a href="structthread__init.html#a609ec6696aaa7d760a8154ddee7e8a49">thread_init::sem</a></div><div class="ttdeci">sem_t sem</div><div class="ttdef"><b>Definition:</b> <a href="dedos__threads_8c_source.html#l00104">dedos_threads.c:104</a></div></div>
<div class="ttc" id="dedos__threads_8c_html_a2035e21970dd9c3b7ce4465805a1cfcd"><div class="ttname"><a href="dedos__threads_8c.html#a2035e21970dd9c3b7ce4465805a1cfcd">dedos_thread_starter</a></div><div class="ttdeci">static void * dedos_thread_starter(void *thread_init_v)</div><div class="ttdoc">The actual function passed to pthread_create() that starts a new thread. </div><div class="ttdef"><b>Definition:</b> <a href="dedos__threads_8c_source.html#l00157">dedos_threads.c:157</a></div></div>
<div class="ttc" id="dedos__threads_8c_html_ad2be2a452f4ee946b74f926d9b885af6"><div class="ttname"><a href="dedos__threads_8c.html#ad2be2a452f4ee946b74f926d9b885af6">get_dedos_thread</a></div><div class="ttdeci">struct dedos_thread * get_dedos_thread(int id)</div><div class="ttdoc">Returns the dedos_thread with the given ID. </div><div class="ttdef"><b>Definition:</b> <a href="dedos__threads_8c_source.html#l00053">dedos_threads.c:53</a></div></div>
<div class="ttc" id="dedos__threads_8h_html_a8c7746e69f0ed91647b8d28e3e660c2a"><div class="ttname"><a href="dedos__threads_8h.html#a8c7746e69f0ed91647b8d28e3e660c2a">dedos_thread_destroy_fn</a></div><div class="ttdeci">void(* dedos_thread_destroy_fn)(struct dedos_thread *thread, void *init_output)</div><div class="ttdoc">Typedef for the destructor function for a dedos_thread. </div><div class="ttdef"><b>Definition:</b> <a href="dedos__threads_8h_source.html#l00058">dedos_threads.h:58</a></div></div>
<div class="ttc" id="structthread__init_html_a29d61655e6d0917cc7e0293a596b4e84"><div class="ttname"><a href="structthread__init.html#a29d61655e6d0917cc7e0293a596b4e84">thread_init::destroy_fn</a></div><div class="ttdeci">dedos_thread_destroy_fn destroy_fn</div><div class="ttdef"><b>Definition:</b> <a href="dedos__threads_8c_source.html#l00102">dedos_threads.c:102</a></div></div>
<div class="ttc" id="dedos__threads_8c_html_aca31b6b12493c91f78b00950c95c9bf8"><div class="ttname"><a href="dedos__threads_8c.html#aca31b6b12493c91f78b00950c95c9bf8">DEFAULT_WAIT_TIMEOUT_S</a></div><div class="ttdeci">#define DEFAULT_WAIT_TIMEOUT_S</div><div class="ttdoc">The amount of time that thread_wait should wait for if no timeout is provided. </div><div class="ttdef"><b>Definition:</b> <a href="dedos__threads_8c_source.html#l00211">dedos_threads.c:211</a></div></div>
<div class="ttc" id="rt__stats_8c_html_ab992698ed0b92b65824db71f24e09c29"><div class="ttname"><a href="rt__stats_8c.html#ab992698ed0b92b65824db71f24e09c29">record_stat</a></div><div class="ttdeci">int record_stat(enum stat_id stat_id, unsigned int item_id, double stat, bool relog)</div><div class="ttdoc">Records a statistic in the statlog. </div><div class="ttdef"><b>Definition:</b> <a href="rt__stats_8c_source.html#l00405">rt_stats.c:405</a></div></div>
<div class="ttc" id="stat__ids_8h_html_ac210bd14ba53357098c0b3ebdd69784ea3c85d2952150487e586b3802e537ccbe"><div class="ttname"><a href="stat__ids_8h.html#ac210bd14ba53357098c0b3ebdd69784ea3c85d2952150487e586b3802e537ccbe">THREAD_UCPUTIME</a></div><div class="ttdef"><b>Definition:</b> <a href="stat__ids_8h_source.html#l00020">stat_ids.h:20</a></div></div>
<div class="ttc" id="dfg_8h_html_a673ccd9aadafd31e8beaf16423c07db2ad7379b426f921781afd49485009640f0"><div class="ttname"><a href="dfg_8h.html#a673ccd9aadafd31e8beaf16423c07db2ad7379b426f921781afd49485009640f0">PINNED_THREAD</a></div><div class="ttdef"><b>Definition:</b> <a href="dfg_8h_source.html#l00074">dfg.h:74</a></div></div>
<div class="ttc" id="dedos__threads_8c_html_a003e2bee2ab0f27a9d2bfec847b30393"><div class="ttname"><a href="dedos__threads_8c.html#a003e2bee2ab0f27a9d2bfec847b30393">MAX_METRIC_INTERVAL_MS</a></div><div class="ttdeci">#define MAX_METRIC_INTERVAL_MS</div><div class="ttdef"><b>Definition:</b> <a href="dedos__threads_8c_source.html#l00213">dedos_threads.c:213</a></div></div>
<div class="ttc" id="stat__ids_8h_html_ac210bd14ba53357098c0b3ebdd69784ea6cb62a4f93fea310ff9dbf5f0e1312c7"><div class="ttname"><a href="stat__ids_8h.html#ac210bd14ba53357098c0b3ebdd69784ea6cb62a4f93fea310ff9dbf5f0e1312c7">THREAD_VCSW</a></div><div class="ttdef"><b>Definition:</b> <a href="stat__ids_8h_source.html#l00025">stat_ids.h:25</a></div></div>
<div class="ttc" id="dedos__threads_8c_html_a8149e98a49e985082afb18b9fe30e94d"><div class="ttname"><a href="dedos__threads_8c.html#a8149e98a49e985082afb18b9fe30e94d">dedos_thread_join</a></div><div class="ttdeci">void dedos_thread_join(struct dedos_thread *thread)</div><div class="ttdoc">Joins and destroys the dedos_thread. </div><div class="ttdef"><b>Definition:</b> <a href="dedos__threads_8c_source.html#l00139">dedos_threads.c:139</a></div></div>
<div class="ttc" id="dedos__threads_8c_html_a84fe48f8c905bad9ee99509742472900"><div class="ttname"><a href="dedos__threads_8c.html#a84fe48f8c905bad9ee99509742472900">dedos_thread_should_exit</a></div><div class="ttdeci">int dedos_thread_should_exit(struct dedos_thread *thread)</div><div class="ttdoc">Returns 1 if the exit signal has been triggered, otherwise 0. </div><div class="ttdef"><b>Definition:</b> <a href="dedos__threads_8c_source.html#l00144">dedos_threads.c:144</a></div></div>
<div class="ttc" id="dedos__threads_8c_html_a705cb27a1ac6915760cf88cebba062ca"><div class="ttname"><a href="dedos__threads_8c.html#a705cb27a1ac6915760cf88cebba062ca">MAX_DEDOS_THREAD_ID</a></div><div class="ttdeci">#define MAX_DEDOS_THREAD_ID</div><div class="ttdoc">The maximum identifier that can be used for a dedos_thread. </div><div class="ttdef"><b>Definition:</b> <a href="dedos__threads_8c_source.html#l00022">dedos_threads.c:22</a></div></div>
<div class="ttc" id="dedos__threads_8c_html_aa740056ba0da4148b051e08640e540f7"><div class="ttname"><a href="dedos__threads_8c.html#aa740056ba0da4148b051e08640e540f7">N_THREAD_STAT_ITEMS</a></div><div class="ttdeci">#define N_THREAD_STAT_ITEMS</div><div class="ttdef"><b>Definition:</b> <a href="dedos__threads_8c_source.html#l00044">dedos_threads.c:44</a></div></div>
<div class="ttc" id="logging_8h_html_a6688e6218820c9d155006dcab23eb611"><div class="ttname"><a href="logging_8h.html#a6688e6218820c9d155006dcab23eb611">log</a></div><div class="ttdeci">#define log(level, fmt,...)</div><div class="ttdoc">Log at a custom level. </div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00128">logging.h:128</a></div></div>
<div class="ttc" id="structdedos__thread_html_ababe14eb9fbd46f21932e27b04785973"><div class="ttname"><a href="structdedos__thread.html#ababe14eb9fbd46f21932e27b04785973">dedos_thread::sem</a></div><div class="ttdeci">sem_t sem</div><div class="ttdoc">Locks thread until a message is available. </div><div class="ttdef"><b>Definition:</b> <a href="dedos__threads_8h_source.html#l00026">dedos_threads.h:26</a></div></div>
<div class="ttc" id="dedos__threads_8h_html_abc395397d24e50b8932e864465a17aa5"><div class="ttname"><a href="dedos__threads_8h.html#abc395397d24e50b8932e864465a17aa5">dedos_thread_fn</a></div><div class="ttdeci">int(* dedos_thread_fn)(struct dedos_thread *thread, void *init_output)</div><div class="ttdoc">Typedef for the function that should be called on a dedos_thread. </div><div class="ttdef"><b>Definition:</b> <a href="dedos__threads_8h_source.html#l00051">dedos_threads.h:51</a></div></div>
<div class="ttc" id="dedos__threads_8c_html_aa336318af10f81d18bfd2ea9fb0ce45d"><div class="ttname"><a href="dedos__threads_8c.html#aa336318af10f81d18bfd2ea9fb0ce45d">start_dedos_thread</a></div><div class="ttdeci">int start_dedos_thread(dedos_thread_fn thread_fn, dedos_thread_init_fn init_fn, dedos_thread_destroy_fn destroy_fn, enum blocking_mode mode, int id, struct dedos_thread *thread)</div><div class="ttdoc">Initilizes and starts execution of a dedos_thread. </div><div class="ttdef"><b>Definition:</b> <a href="dedos__threads_8c_source.html#l00250">dedos_threads.c:250</a></div></div>
<div class="ttc" id="dedos__threads_8c_html_a3c60433df66ec61cd178275f4231db3d"><div class="ttname"><a href="dedos__threads_8c.html#a3c60433df66ec61cd178275f4231db3d">dedos_threads</a></div><div class="ttdeci">static struct dedos_thread * dedos_threads[32+2]</div><div class="ttdoc">Static structure to hold created dedos_thread&#39;s. </div><div class="ttdef"><b>Definition:</b> <a href="dedos__threads_8c_source.html#l00030">dedos_threads.c:30</a></div></div>
<div class="ttc" id="output__thread_8h_html_ae1a58cdf173436fc88c06c639f6e8cbb"><div class="ttname"><a href="output__thread_8h.html#ae1a58cdf173436fc88c06c639f6e8cbb">OUTPUT_THREAD_ID</a></div><div class="ttdeci">#define OUTPUT_THREAD_ID</div><div class="ttdoc">A thread_msg marked for delivery to this thread ID will be enqueued to the output thread...</div><div class="ttdef"><b>Definition:</b> <a href="output__thread_8h_source.html#l00016">output_thread.h:16</a></div></div>
<div class="ttc" id="message__queue_8c_html_a475676d4d62424d511cd2ebb12919f37"><div class="ttname"><a href="message__queue_8c.html#a475676d4d62424d511cd2ebb12919f37">init_msg_queue</a></div><div class="ttdeci">int init_msg_queue(struct msg_queue *q, sem_t *sem)</div><div class="ttdoc">Initilializes a mesasge queue to have no messages in it, and sets up the mutex and semaphore...</div><div class="ttdef"><b>Definition:</b> <a href="message__queue_8c_source.html#l00134">message_queue.c:134</a></div></div>
<div class="ttc" id="structdedos__thread_html_ace61dc188bd6d8018126c508b1a42493"><div class="ttname"><a href="structdedos__thread.html#ace61dc188bd6d8018126c508b1a42493">dedos_thread::queue</a></div><div class="ttdeci">struct msg_queue queue</div><div class="ttdoc">Queue for incoming message. </div><div class="ttdef"><b>Definition:</b> <a href="dedos__threads_8h_source.html#l00024">dedos_threads.h:24</a></div></div>
<div class="ttc" id="dedos__threads_8h_html_a05cf7cb0c2d44afe48767196d7554f55"><div class="ttname"><a href="dedos__threads_8h.html#a05cf7cb0c2d44afe48767196d7554f55">dedos_thread_init_fn</a></div><div class="ttdeci">void *(* dedos_thread_init_fn)(struct dedos_thread *thread)</div><div class="ttdoc">Typedef for an initialization function for a dedos_thread. </div><div class="ttdef"><b>Definition:</b> <a href="dedos__threads_8h_source.html#l00043">dedos_threads.h:43</a></div></div>
<div class="ttc" id="logging_8h_html_afd2d22d45a6b32ff3ff8ea73013f09dc"><div class="ttname"><a href="logging_8h.html#afd2d22d45a6b32ff3ff8ea73013f09dc">log_warn</a></div><div class="ttdeci">#define log_warn(fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00094">logging.h:94</a></div></div>
<div class="ttc" id="structthread__init_html_a35c0110fa8e8385bd0c6e823a7e5c30a"><div class="ttname"><a href="structthread__init.html#a35c0110fa8e8385bd0c6e823a7e5c30a">thread_init::self</a></div><div class="ttdeci">struct dedos_thread * self</div><div class="ttdef"><b>Definition:</b> <a href="dedos__threads_8c_source.html#l00103">dedos_threads.c:103</a></div></div>
<div class="ttc" id="dedos__threads_8c_html_afb032c6cebdf1139918c77512a8d5391"><div class="ttname"><a href="dedos__threads_8c.html#afb032c6cebdf1139918c77512a8d5391">thread_stat_items</a></div><div class="ttdeci">enum stat_id thread_stat_items[]</div><div class="ttdef"><b>Definition:</b> <a href="dedos__threads_8c_source.html#l00034">dedos_threads.c:34</a></div></div>
<div class="ttc" id="dedos__threads_8c_html_a52b3a7e9424f741c06d541d059a47e98"><div class="ttname"><a href="dedos__threads_8c.html#a52b3a7e9424f741c06d541d059a47e98">init_dedos_thread</a></div><div class="ttdeci">static int init_dedos_thread(struct dedos_thread *thread, enum thread_mode mode, int id)</div><div class="ttdoc">Initializes a dedos_thread structure to contain the appropriate fields. </div><div class="ttdef"><b>Definition:</b> <a href="dedos__threads_8c_source.html#l00073">dedos_threads.c:73</a></div></div>
<div class="ttc" id="structdedos__thread_html"><div class="ttname"><a href="structdedos__thread.html">dedos_thread</a></div><div class="ttdoc">Structure representing any thread within DeDOS. </div><div class="ttdef"><b>Definition:</b> <a href="dedos__threads_8h_source.html#l00016">dedos_threads.h:16</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
